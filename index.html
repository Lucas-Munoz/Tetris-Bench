<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tetris Bench</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js"></script>
</head>
<body>
    <script src="Tablero.js"></script>
    <script>
        const margin_tablero = 15
        let speed_regulator = 0
        function setup(){
            createCanvas(900,600)
            tablero = new TableroT()
            createMapBaseTetriminos()
            tetrimino = new Tetrimino()
            resizeCanvas(
                tablero.ancho + 2*margin_tablero,
                tablero.alto + 2*margin_tablero
            )
        }

        function keyEventTetris(){
            if (millis()-speed_regulator < 150){
                return
            }
            speed_regulator = millis()

            if (keyIsDown(RIGHT_ARROW)){
               tetrimino.rightMov()
            }
            if (keyIsDown(LEFT_ARROW)){
                tetrimino.leftMov()
            }     
            if (keyIsDown(UP_ARROW)){
                tetrimino.upMov()
            }
            if (keyIsDown(DOWN_ARROW)){
                tetrimino.downMov()
            }     
        }
        function draw(){
            background("lightgray")
            tablero.dibujar()
            tetrimino.dibujar()
            keyEventTetris()
        }
       function createMapBaseTetriminos(){
        tetriminosBase = {
            "Z":{
                color:"red",
                map:[
                createVector(),
                createVector(1,-1),
                createVector(0,-1),
                createVector(1,0)
                ]
            }
        }
       }


        class Tetrimino{
            constructor(nombre = "Z"){
                this.nombre = nombre
                let tetriminoBase = tetriminosBase[nombre]
                this.color = tetriminoBase.color
                this.map = []
                for (const pmino of tetriminoBase.map){
                    this.map.push(pmino.copy())
                }
                this.posicion = createVector(int(tablero.columnas / 2),0)
            }
            rightMov(){
                this.posicion.x++
            }
            leftMov(){
                this.posicion.x--
            }
            upMov(){
                this.posicion.y--
            }
            downMov(){
                this.posicion.y++
            }
            get mapTablero(){
                let retorno = []
                for(const pmino of this.map){
                    let copy = pmino.copy().add(this.posicion)
                    retorno.push (tablero.coordenada(copy.x, copy.y))
                }
                return retorno
            }

            dibujar(){
                push()
                fill("red")
                for (const pmino of this.mapTablero){
                    let coord = tablero.coordenada(pmino.x, pmino.y)
                    rect(pmino.x, pmino.y, tablero.lado)
                }
                pop()
            }
        }
    </script>
</body>
</html>